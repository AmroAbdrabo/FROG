apiVersion: v1
kind: ConfigMap
metadata:
  name: frog-dash-cm
data:
  METEOR_SETTINGS: |
    {
      "dashboardServer": true,
      "public": {
        "friendlyProduction": true
      },
      "sharedb_dburl": "mongodb://mongo-test-service:27017",
      "sharedb_redis": "redis-test-service:6379",
      "logserverRedis" : "redis://redis-test-service:6379",
      "externalOperatorRedis": "redis://redis-test-service:6379",
      "token": "9f8sd0f98sdfj3j4jFFFF1",
      "Minio": { "urls": ["https://icchilisrv3.epfl.ch:9000"]} 
    }

  ROOT_URL: http://minikube:5000
  MONGO_URL: mongodb://mongo-test-service:27017/meteor
  PORT: "3000"

--- 

apiVersion: apps/v1
kind: Deployment
metadata:
  name: frog-dash-test-deployment
  labels:
    app: frog-dash
    env-type: test

spec:
  replicas: 1
  selector:
    matchLabels:
      app: frog-dash
      tier: backend
      env-type: test

  # POD declaration
  template:
    metadata:
      labels:
        app: frog-dash
        tier: backend
        env-type: test

    spec:
      containers:
        - name: frog-dash
          image: arasmumcuyan/frog:test
          imagePullPolicy: Always
          command: ["node", "main.js"]
          ports:
            - containerPort: 5000
          envFrom:
            - configMapRef:
                name: frog-dash-cm

      # TODO: maybe find a better to set regred instead of command line
      imagePullSecrets:
        - name: regcred
---
######## Service Configuration ########
######## Open an external port to outside of the cluster, type=NodePort ##########
kind: Service
apiVersion: v1
metadata:
  name: frog-dashboard-service
spec:
  selector: # for pods     
    app: frog
    env-type: test
  
  type: ClusterIP # external port 
  ports:
  - port: 5000   # port of service will be listening from Node (will be sent to service on behalf of end-user)
    targetPort: 5000   # port of pod is listening which service wiil forward